---
title: "Amounts and tables exercises"
author: "Jon Chernus"
output:
  html_document:
    code_folding: show
---

# Setup

## Packages 

```{r}
library(tidyverse)
library(gtsummary)
library(janitor)
library(tibble)
library(knitr)
```

## Data

We are going to use three tables.

First read in `d.csv`, which has some individual-level data on 1000 Genomes Project subjects, as a data frame called `d`.

Then copy and paste this code to create `d_summary` and `d_summary2`, which will be population-level summary tables:

```
d_summary <- d %>% group_by(superpop_name) %>% summarize(sampsize=n())
d_summary

d_summary2 <- d %>% group_by(pop) %>% summarize(sampsize=n())
d_summary2
```



```{r}
# Read in d here
# Copy and paste code to make d_summary and d_summary2
# Run head(d), and print the two summary tables
```

# Exercises

## Barplot 1

First, make a basic barplot showing the sample sizes (`sampsize`) for each population group in `d_summary`. Put `sampsize` on the y-axis for now. (You might try `geom_bar` first, but why doesn't that work? What geom do you need?)

```{r}
# Your code here
```

## Barplot 2

There are (at least) two obvious improvement to make to this barplot.

- What do you notice about the population names?

- What do you notice about the order of the bars?

There is a simple fix for the first issue (which doesn't involve tilting the population names or changing the font). Implement it below. Also re-order the columns from largest to smallest. Use the `fct_reorder` function to help you. You need to give it two arguments. Check `?fct_reoder`, scroll down to the Examples section, and run the first example to see how it works.

```{r}
# Your code here
```

## Barplot 3

Now make a sorted bar graph for `d_summary2`, with vertical bars.

```{r}
# Your code here
```

## Barplot 4

It's quite difficult to tell the difference in height between adjacent bars. Use `geom_text` to label each bar with its height. What aesthetics do you need to add for that layer? (Hint: check `?geom_text` and scroll down to the Aesthetics section, where the required aesthetics are in bold.)

```{r}
# Your code here
```

## Barplots 5-6

Now let's use data from ClinVar summarizing BRCA1/BRCA2 mutations.

The data are in `cv.csv`, which you should download from the class book/website and read in. Apply `head` to see the variables. We will also pre-process a little.

```{r}
# Read in cv and apply head to it
```


Before proceeding, copy and paste this code into the top of the next chunk to process the data a little more:

```
clinsig_levels <- c(
  "Benign",
  "Likely benign",
  "Uncertain significance",
  "Likely pathogenic",
  "Pathogenic"
)

cv <- cv %>%
  mutate(
    clinsig = factor(
      clinsig,
      levels = clinsig_levels,
      ordered = TRUE
    )
  )
```

Make two barplots as follows

- The first plot should enable you to ask and answer questions like "Within each mutation type, what is the distribution of clinical significance?"

- The second plot emphasize the breakdown of mutation type within each level of clinical signifance.

- There should be separate panels for BRCA1 and BRCA2

Hints/guidelines

- What geom should you use?

- What aesthetics do you need?

- Remember to copy and paste the code above in order to reorder the factor variable `clinsig`.

- What should you facet by?

- Using commands from the last exercise, assign an appropriate color palette to each. Think about what comparisons each plot emphasizes, and what kind of color palette is appropriate for each.

```{r}
# Copy and paste the helper code from above

# Your code for the two barplots also goes here
```

## Barplot 7

Now suppose you want a figure, still faceting by gene, showing the proportion of each clinsig level within each mutation type (each bar should add up to 100%).

Hints:

- Include `position="fill"` and `stat="count"`

```{r}
# Your code here
```

## Barplot 8

Here are some allele frequencies:

```{r}
maf_tbl <- tribble(
  ~snp,        ~maf,
  "rs429358",  0.471,
  "rs7412",    0.462,
  "rs769449",  0.479,
  "rs405509",  0.452,
  "rs440446",  0.468,
  "rs157580",  0.474,
  "rs2075650", 0.469,
  "rs6857",    0.466,
  "rs157581",  0.472,
  "rs8106922", 0.458,
  "rs7259620", 0.476,
  "rs34404554",0.463
)

kable(maf_tbl)

```

Make a barplot of them. What's wrong with the plot?

```{r}
# Your code here
```


## Barplot 9

Note that you can reorder the bars with the `reorder` function, which will need two arguments.

```{r}
# Your code here
```

## "Barplot" 10 (not actually a barplot)

Now make a new version of the plot that solves the previous problem. (Use a different geom.)

```{r}
# Your code here
```

## Plot 11 (not a barplot, either)

Finally, here are simulated some GWAS stats.

```{r}
gwas_data <- tribble(
  ~snp,        ~maf,  ~beta,   ~pval,
  "rs101",     0.48,  0.012,   2e-20,
  "rs102",     0.44, -0.009,   5e-15,
  "rs103",     0.39,  0.015,   1e-25,
  "rs104",     0.32,  0.008,   4e-10,
  "rs105",     0.27, -0.011,   7e-18,
  "rs106",     0.21,  0.006,   9e-8,
  "rs107",     0.18, -0.014,   3e-22,
  "rs108",     0.12,  0.010,   6e-14,
  "rs109",     0.08,  0.018,   2e-30,
  "rs110",     0.06, -0.020,   8e-35,
  "rs111",     0.45,  0.004,   2e-6,
  "rs112",     0.41, -0.005,   9e-7,
  "rs113",     0.36,  0.007,   3e-9,
  "rs114",     0.29, -0.006,   1e-8,
  "rs115",     0.23,  0.005,   4e-7
)

kable(gwas_data)
```

Make a plot that relates allele frequency to effect size (use the absolute value) while also showing statistical significance (be sure to transform the p-values).

```{r}
# Your code here
```

## 12 `gtsummary`

P.S.: Check out the `gtsummary` package for making publication-ready tables with minimal effort.

[https://www.danieldsjoberg.com/gtsummary/articles/tbl_summary.html](https://www.danieldsjoberg.com/gtsummary/articles/tbl_summary.html)

```{r}
# Try gtsummaryt here?
```

